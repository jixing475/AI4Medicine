<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI4M C1 W1 lecture ex 01 • AI4Medicine</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="AI4M C1 W1 lecture ex 01">
<meta property="og:description" content="AI4Medicine">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AI4Medicine</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AI4M_C1_W1_lecture_ex_01.html">AI4M C1 W1 lecture ex 01</a>
    </li>
    <li>
      <a href="../articles/rpy2_test.html">rpy2</a>
    </li>
    <li>
      <a href="../articles/setup.html">setup </a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jixing475/AI4Medicine/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="AI4M_C1_W1_lecture_ex_01_files/header-attrs-2.9.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>AI4M C1 W1 lecture ex 01</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jixing475/AI4Medicine/blob/master/vignettes/AI4M_C1_W1_lecture_ex_01.rmd" class="external-link"><code>vignettes/AI4M_C1_W1_lecture_ex_01.rmd</code></a></small>
      <div class="hidden name"><code>AI4M_C1_W1_lecture_ex_01.rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rpy2.ipython</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>cwd <span class="op">=</span> os.getcwd()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>cwd</span></code></pre></div>
<pre><code>'/Users/zero/Desktop/AI4Medicine/vignettes'</code></pre>
<div id="data-explore" class="section level1">
<h1 class="hasAnchor">
<a href="#data-explore" class="anchor" aria-hidden="true"></a>Data Explore</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read csv file containing training datadata</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.read_csv(<span class="st">"../analysis/notebooks/Diagnosis/M1/nih/train-small.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first 5 rows</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>train_df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> rows and </span><span class="sc">{</span>train_df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> columns in this data frame'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>train_df.head()</span></code></pre></div>
<pre><code>There are 1000 rows and 16 columns in this data frame</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="table dataframe">
<thead><tr style="text-align: right;">
<th>
</th>
<th>
Image
</th>
<th>
Atelectasis
</th>
<th>
Cardiomegaly
</th>
<th>
Consolidation
</th>
<th>
Edema
</th>
<th>
Effusion
</th>
<th>
Emphysema
</th>
<th>
Fibrosis
</th>
<th>
Hernia
</th>
<th>
Infiltration
</th>
<th>
Mass
</th>
<th>
Nodule
</th>
<th>
PatientId
</th>
<th>
Pleural_Thickening
</th>
<th>
Pneumonia
</th>
<th>
Pneumothorax
</th>
</tr></thead>
<tbody>
<tr>
<th>
0
</th>
<td>
00008270_015.png
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
8270
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
00029855_001.png
</td>
<td>
1
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
1
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
1
</td>
<td>
0
</td>
<td>
0
</td>
<td>
29855
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
00001297_000.png
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
1297
</td>
<td>
1
</td>
<td>
0
</td>
<td>
0
</td>
</tr>
<tr>
<th>
3
</th>
<td>
00012359_002.png
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
12359
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
</tr>
<tr>
<th>
4
</th>
<td>
00017951_001.png
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
<td>
1
</td>
<td>
0
</td>
<td>
0
</td>
<td>
17951
</td>
<td>
0
</td>
<td>
0
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../analysis/notebooks/Diagnosis/M1/nih/train-small.csv"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">'There are {nrow(train_df)} rows and {ncol(train_df)} columns in this data frame'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>[36m──[39m [1m[1mColumn specification[1m[22m [36m────────────────────────────────────────────────────────[39m
cols(
  Image = [31mcol_character()[39m,
  Atelectasis = [32mcol_double()[39m,
  Cardiomegaly = [32mcol_double()[39m,
  Consolidation = [32mcol_double()[39m,
  Edema = [32mcol_double()[39m,
  Effusion = [32mcol_double()[39m,
  Emphysema = [32mcol_double()[39m,
  Fibrosis = [32mcol_double()[39m,
  Hernia = [32mcol_double()[39m,
  Infiltration = [32mcol_double()[39m,
  Mass = [32mcol_double()[39m,
  Nodule = [32mcol_double()[39m,
  PatientId = [32mcol_double()[39m,
  Pleural_Thickening = [32mcol_double()[39m,
  Pneumonia = [32mcol_double()[39m,
  Pneumothorax = [32mcol_double()[39m
)

Rows: 1,000
Columns: 16
$ Image              [3m[90m&lt;chr&gt;[39m[23m "00008270_015.png", "00029855_001.png", "00001297_0…
$ Atelectasis        [3m[90m&lt;dbl&gt;[39m[23m 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, …
$ Cardiomegaly       [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Consolidation      [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Edema              [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Effusion           [3m[90m&lt;dbl&gt;[39m[23m 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Emphysema          [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Fibrosis           [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Hernia             [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Infiltration       [3m[90m&lt;dbl&gt;[39m[23m 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Mass               [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Nodule             [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, …
$ PatientId          [3m[90m&lt;dbl&gt;[39m[23m 8270, 29855, 1297, 12359, 17951, 1232, 17135, 27235…
$ Pleural_Thickening [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Pneumonia          [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Pneumothorax       [3m[90m&lt;dbl&gt;[39m[23m 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
<div id="data-types-and-null-values-check" class="section level1">
<h1 class="hasAnchor">
<a href="#data-types-and-null-values-check" class="anchor" aria-hidden="true"></a>Data types and null values check</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the data type of each column and whether null values are present</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>train_df.info()</span></code></pre></div>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 16 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   Image               1000 non-null   object
 1   Atelectasis         1000 non-null   int64 
 2   Cardiomegaly        1000 non-null   int64 
 3   Consolidation       1000 non-null   int64 
 4   Edema               1000 non-null   int64 
 5   Effusion            1000 non-null   int64 
 6   Emphysema           1000 non-null   int64 
 7   Fibrosis            1000 non-null   int64 
 8   Hernia              1000 non-null   int64 
 9   Infiltration        1000 non-null   int64 
 10  Mass                1000 non-null   int64 
 11  Nodule              1000 non-null   int64 
 12  PatientId           1000 non-null   int64 
 13  Pleural_Thickening  1000 non-null   int64 
 14  Pneumonia           1000 non-null   int64 
 15  Pneumothorax        1000 non-null   int64 
dtypes: int64(15), object(1)
memory usage: 125.1+ KB</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  DataExplorer<span class="sc">::</span><span class="fu">plot_missing</span>(.)</span></code></pre></div>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_7_0.png" alt=""><p class="caption">png</p>
</div>
</div>
<div id="unique-ids-check" class="section level1">
<h1 class="hasAnchor">
<a href="#unique-ids-check" class="anchor" aria-hidden="true"></a>Unique IDs check</h1>
<p>“PatientId” has an identification number for each patient.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The total patient ids are </span><span class="sc">{</span>train_df[<span class="st">'PatientId'</span>]<span class="sc">.</span>count()<span class="sc">}</span><span class="ss">, from those the unique ids are </span><span class="sc">{</span>train_df[<span class="st">'PatientId'</span>]<span class="sc">.</span>value_counts()<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> "</span>)</span></code></pre></div>
<pre><code>The total patient ids are 1000, from those the unique ids are 928 </code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">"The total patient ids are {train_df$PatientId %&gt;% length}, from those the unique ids are {train_df %&gt;% count(PatientId) %&gt;% nrow()} "</span>)</span></code></pre></div>
<pre><code>The total patient ids are 1000, from those the unique ids are 928 
FALSE</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"row_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">get_dupes</span>(PatientId) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dupe_count <span class="sc">%&gt;%</span> desc) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>[90m# A tibble: 6 x 18[39m
  PatientId dupe_count row_id Image Atelectasis Cardiomegaly Consolidation Edema
      [3m[90m&lt;dbl&gt;[39m[23m      [3m[90m&lt;int&gt;[39m[23m  [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m       [3m[90m&lt;dbl&gt;[39m[23m        [3m[90m&lt;dbl&gt;[39m[23m         [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m     [4m2[24m[4m0[24m213          6    198 0002…           0            0             0     0
[90m2[39m     [4m2[24m[4m0[24m213          6    297 0002…           1            0             1     0
[90m3[39m     [4m2[24m[4m0[24m213          6    441 0002…           0            0             1     0
[90m4[39m     [4m2[24m[4m0[24m213          6    790 0002…           0            0             1     0
[90m5[39m     [4m2[24m[4m0[24m213          6    841 0002…           1            0             0     0
[90m6[39m     [4m2[24m[4m0[24m213          6    986 0002…           0            0             1     0
[90m# … with 10 more variables: Effusion &lt;dbl&gt;, Emphysema &lt;dbl&gt;, Fibrosis &lt;dbl&gt;,[39m
[90m#   Hernia &lt;dbl&gt;, Infiltration &lt;dbl&gt;, Mass &lt;dbl&gt;, Nodule &lt;dbl&gt;,[39m
[90m#   Pleural_Thickening &lt;dbl&gt;, Pneumonia &lt;dbl&gt;, Pneumothorax &lt;dbl&gt;[39m</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"row_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">get_dupes</span>(PatientId) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(PatientId, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(dupe_count) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  DataExplorer<span class="sc">::</span><span class="fu">plot_histogram</span>()</span></code></pre></div>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_12_0.png" alt=""><p class="caption">png</p>
</div>
</div>
<div id="explore-data-labels" class="section level1">
<h1 class="hasAnchor">
<a href="#explore-data-labels" class="anchor" aria-hidden="true"></a>Explore Data Labels</h1>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> train_df.keys()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> <span class="bu">list</span>(columns)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(columns)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecesary elements</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>columns.remove(<span class="st">'Image'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>columns.remove(<span class="st">'PatientId'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the total classes</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(columns)<span class="sc">}</span><span class="ss"> columns of labels for these conditions: </span><span class="sc">{</span>columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the number of positive labels for each class</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> columns:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The class </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> has </span><span class="sc">{</span>train_df[column]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> samples"</span>)</span></code></pre></div>
<pre><code>['Image', 'Atelectasis', 'Cardiomegaly', 'Consolidation', 'Edema', 'Effusion', 'Emphysema', 'Fibrosis', 'Hernia', 'Infiltration', 'Mass', 'Nodule', 'PatientId', 'Pleural_Thickening', 'Pneumonia', 'Pneumothorax']
There are 14 columns of labels for these conditions: ['Atelectasis', 'Cardiomegaly', 'Consolidation', 'Edema', 'Effusion', 'Emphysema', 'Fibrosis', 'Hernia', 'Infiltration', 'Mass', 'Nodule', 'Pleural_Thickening', 'Pneumonia', 'Pneumothorax']
The class Atelectasis has 106 samples
The class Cardiomegaly has 20 samples
The class Consolidation has 33 samples
The class Edema has 16 samples
The class Effusion has 128 samples
The class Emphysema has 13 samples
The class Fibrosis has 14 samples
The class Hernia has 2 samples
The class Infiltration has 175 samples
The class Mass has 45 samples
The class Nodule has 54 samples
The class Pleural_Thickening has 21 samples
The class Pneumonia has 10 samples
The class Pneumothorax has 38 samples</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Image, <span class="sc">-</span>PatientId) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>() </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"There are {</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">  columns %&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">    length()</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">  } columns of labels for these conditions: {</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">    columns %&gt;% </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">    str_c(collapse = ', ')</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">  }"</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(columns) <span class="sc">%&gt;%</span> </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head() %&gt;% </span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">sum</span>(.x)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">"n_samples"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"class_name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> <span class="fu">str_glue</span>(<span class="st">"The class {class_name} has {n_samples} samples"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(res)</span></code></pre></div>
<pre><code>Note: Using an external vector in selections is ambiguous.
[34mℹ[39m Use `all_of(columns)` instead of `columns` to silence this message.
[34mℹ[39m See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
[90mThis message is displayed once per session.[39m
[90m# A tibble: 14 x 1[39m
[90m# Rowwise: [39m
   res                                        
   [3m[90m&lt;glue&gt;[39m[23m                                     
[90m 1[39m The class Atelectasis has 106 samples      
[90m 2[39m The class Cardiomegaly has 20 samples      
[90m 3[39m The class Consolidation has 33 samples     
[90m 4[39m The class Edema has 16 samples             
[90m 5[39m The class Effusion has 128 samples         
[90m 6[39m The class Emphysema has 13 samples         
[90m 7[39m The class Fibrosis has 14 samples          
[90m 8[39m The class Hernia has 2 samples             
[90m 9[39m The class Infiltration has 175 samples     
[90m10[39m The class Mass has 45 samples              
[90m11[39m The class Nodule has 54 samples            
[90m12[39m The class Pleural_Thickening has 21 samples
[90m13[39m The class Pneumonia has 10 samples         
[90m14[39m The class Pneumothorax has 38 samples      </code></pre>
</div>
<div id="data-visualization" class="section level1">
<h1 class="hasAnchor">
<a href="#data-visualization" class="anchor" aria-hidden="true"></a>Data Visualization</h1>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract numpy values from Image column in data frame</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#images = train_df['Image'].values</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> [<span class="st">"00016189_001.png"</span>, <span class="st">"00016508_040.png"</span>, <span class="st">"00017417_008.png"</span>, <span class="st">"00017470_002.png"</span>, <span class="st">"00017503_003.png"</span>, <span class="st">"00017504_059.png"</span>, <span class="st">"00017508_000.png"</span>, <span class="st">"00017524_018.png"</span>, <span class="st">"00017541_032.png"</span>, <span class="st">"00017549_001.png"</span>, <span class="st">"00017587_004.png"</span>, <span class="st">"00017645_002.png"</span>, <span class="st">"00017691_003.png"</span>, <span class="st">"00017702_000.png"</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 9 random images from it</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>random_images <span class="op">=</span> [np.random.choice(images) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>)]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Location of the image dir</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>img_dir <span class="op">=</span> <span class="st">'../analysis/notebooks/Diagnosis/M1/nih/images-small/'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Display Random Images'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the size of your images</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate and plot random images</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>):</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> plt.imread(os.path.join(img_dir, random_images[i]))</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    plt.imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust subplot parameters to give specified padding</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() </span></code></pre></div>
<pre><code>Display Random Images</code></pre>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_17_1.png" alt=""><p class="caption">png</p>
</div>
</div>
<div id="investigate-a-single-image" class="section level1">
<h1 class="hasAnchor">
<a href="#investigate-a-single-image" class="anchor" aria-hidden="true"></a>Investigate a single image</h1>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the first image that was listed in the train_df dataframe</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sample_img <span class="op">=</span> train_df.Image[<span class="dv">1</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>raw_image <span class="op">=</span> plt.imread(os.path.join(img_dir, sample_img))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.imshow(raw_image, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Raw Chest X Ray Image'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The dimensions of the image are </span><span class="sc">{</span>raw_image<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> pixels width and </span><span class="sc">{</span>raw_image<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels height, one single color channel"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The maximum pixel value is </span><span class="sc">{</span>raw_image<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss"> and the minimum is </span><span class="sc">{</span>raw_image<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The mean value of the pixels is </span><span class="sc">{</span>raw_image<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss"> and the standard deviation is </span><span class="sc">{</span>raw_image<span class="sc">.</span>std()<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_19_0.png" alt=""><p class="caption">png</p>
</div>
<pre><code>The dimensions of the image are 1024 pixels width and 1024 pixels height, one single color channel
The maximum pixel value is 1.0000 and the minimum is 0.0000
The mean value of the pixels is 0.4669 and the standard deviation is 0.2492</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sample_img</span></code></pre></div>
<pre><code>'00029855_001.png'</code></pre>
</div>
<div id="investigate-pixel-value-distribution" class="section level1">
<h1 class="hasAnchor">
<a href="#investigate-pixel-value-distribution" class="anchor" aria-hidden="true"></a>Investigate pixel value distribution</h1>
<p>Run the cell below to plot up the distribution of pixel values in the image shown above.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a histogram of the distribution of the pixels</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sns.distplot(raw_image.ravel(), </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Pixel Mean </span><span class="sc">{np.</span>mean(raw_image)<span class="sc">:.4f}</span><span class="ss"> &amp; Standard Deviation </span><span class="sc">{np.</span>std(raw_image)<span class="sc">:.4f}</span><span class="ss">'</span>, kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper center'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Pixel Intensities in the Image'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Pixel Intensity'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'# Pixels in Image'</span>)</span></code></pre></div>
<pre><code>/Users/zero/anaconda3/envs/AI4Medicine/lib/python3.7/site-packages/seaborn/distributions.py:2557: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)





Text(0, 0.5, '# Pixels in Image')</code></pre>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_22_2.png" alt=""><p class="caption">png</p>
</div>
</div>
<div id="image-preprocessing-in-keras" class="section level1">
<h1 class="hasAnchor">
<a href="#image-preprocessing-in-keras" class="anchor" aria-hidden="true"></a>Image Preprocessing in Keras</h1>
<p>Before training, you’ll first modify your images to be better suited for training a convolutional neural network. For this task you’ll use the Keras <a href="https://keras.io/preprocessing/image/" class="external-link">ImageDataGenerator</a> function to perform data preprocessing and data augmentation.</p>
<p>Run the next two cells to import this function and create an image generator for preprocessing.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data generator from keras</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize images</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>image_generator <span class="op">=</span> ImageDataGenerator(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    samplewise_center<span class="op">=</span><span class="va">True</span>, <span class="co">#Set each sample mean to 0.</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    samplewise_std_normalization<span class="op">=</span> <span class="va">True</span> <span class="co"># Divide each input by its standard deviation</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="standardization" class="section level3">
<h3 class="hasAnchor">
<a href="#standardization" class="anchor" aria-hidden="true"></a>Standardization</h3>
<p>The <code>image_generator</code> you created above will act to adjust your image data such that the new mean of the data will be zero, and the standard deviation of the data will be 1.</p>
<p>In other words, the generator will replace each pixel value in the image with a new value calculated by subtracting the mean and dividing by the standard deviation.</p>
<p><span class="math display">\[
\frac{x_{i}-\mu}{\sigma}
\]</span></p>
<p>Run the next cell to pre-process your data using the <code>image_generator</code>. In this step you will also be reducing the image size down to 320x320 pixels.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R <span class="sc">-</span>o train_df</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>images_names <span class="ot">&lt;-</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"../analysis/notebooks/Diagnosis/M1/nih/images-small/"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">basename</span>()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>train_df <span class="ot">&lt;-</span>      </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>train_df <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(Image <span class="sc">%in%</span> images_names)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flow from directory with specified batch size and target image size</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> image_generator.flow_from_dataframe(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        dataframe<span class="op">=</span>train_df,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        directory<span class="op">=</span><span class="st">"../analysis/notebooks/Diagnosis/M1/nih/images-small/"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        x_col<span class="op">=</span><span class="st">"Image"</span>, <span class="co"># features</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Let's say we build a model for mass detection</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        y_col<span class="op">=</span> [<span class="st">'Mass'</span>], <span class="co"># labels</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        class_mode<span class="op">=</span><span class="st">"raw"</span>, <span class="co"># 'Mass' column should be in train_df</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span> <span class="dv">1</span>, <span class="co"># images per batch</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        shuffle<span class="op">=</span><span class="va">False</span>, <span class="co"># shuffle the rows or not</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        target_size<span class="op">=</span>(<span class="dv">320</span>,<span class="dv">320</span>) <span class="co"># width and height of output image</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Found 776 validated image filenames.</code></pre>
<p>Run the next cell to plot up an example of a pre-processed image</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a processed image</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"white"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>generated_image, label <span class="op">=</span> generator.<span class="fu">__getitem__</span>(<span class="dv">0</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plt.imshow(generated_image[<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Raw Chest X Ray Image'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The dimensions of the image are </span><span class="sc">{</span>generated_image<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels width and </span><span class="sc">{</span>generated_image<span class="sc">.</span>shape[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> pixels height"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The maximum pixel value is </span><span class="sc">{</span>generated_image<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss"> and the minimum is </span><span class="sc">{</span>generated_image<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The mean value of the pixels is </span><span class="sc">{</span>generated_image<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss"> and the standard deviation is </span><span class="sc">{</span>generated_image<span class="sc">.</span>std()<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div>
<pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).


The dimensions of the image are 320 pixels width and 320 pixels height
The maximum pixel value is 2.1455 and the minimum is -1.8822
The mean value of the pixels is -0.0000 and the standard deviation is 1.0000</code></pre>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_30_2.png" alt=""><p class="caption">png</p>
</div>
<p>Run the cell below to see a comparison of the distribution of pixel values in the new pre-processed image versus the raw image.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Include a histogram of the distribution of the pixels</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for original iamge</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>sns.distplot(raw_image.ravel(), </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Original Image: mean </span><span class="sc">{np.</span>mean(raw_image)<span class="sc">:.4f}</span><span class="ss"> - Standard Deviation </span><span class="sc">{np.</span>std(raw_image)<span class="sc">:.4f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss"> '</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>             <span class="ss">f'Min pixel value </span><span class="sc">{np.</span><span class="bu">min</span>(raw_image)<span class="sc">:.4}</span><span class="ss"> - Max pixel value </span><span class="sc">{np.</span><span class="bu">max</span>(raw_image)<span class="sc">:.4}</span><span class="ss">'</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'blue'</span>, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>             kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for generated image</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>sns.distplot(generated_image[<span class="dv">0</span>].ravel(), </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Generated Image: mean </span><span class="sc">{np.</span>mean(generated_image[<span class="dv">0</span>])<span class="sc">:.4f}</span><span class="ss"> - Standard Deviation </span><span class="sc">{np.</span>std(generated_image[<span class="dv">0</span>])<span class="sc">:.4f}</span><span class="ss"> </span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>             <span class="ss">f'Min pixel value </span><span class="sc">{np.</span><span class="bu">min</span>(generated_image[<span class="dv">0</span>])<span class="sc">:.4}</span><span class="ss"> - Max pixel value </span><span class="sc">{np.</span><span class="bu">max</span>(generated_image[<span class="dv">0</span>])<span class="sc">:.4}</span><span class="ss">'</span>, </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'red'</span>, </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>             kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Place legends</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Pixel Intensities in the Image'</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Pixel Intensity'</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'# Pixel'</span>)</span></code></pre></div>
<pre><code>/Users/zero/anaconda3/envs/AI4Medicine/lib/python3.7/site-packages/seaborn/distributions.py:2557: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)





Text(0, 0.5, '# Pixel')</code></pre>
<div class="figure">
<img src="AI4M_C1_W1_lecture_ex_01_files/AI4M_C1_W1_lecture_ex_01_32_2.png" alt=""><p class="caption">png</p>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(raw_image)</span></code></pre></div>
<pre><code>numpy.ndarray</code></pre>
<p>image download url: <a href="https://wwlhugij.labs.coursera.org/files/M1/nih/images-small/00000003_001.png" class="external-link uri">https://wwlhugij.labs.coursera.org/files/M1/nih/images-small/00000003_001.png</a></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="sc">%%</span>R</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>image_names <span class="ot">&lt;-</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"../analysis/notebooks/Diagnosis/M1/nih/images_name.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Field1)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_glue</span>(<span class="st">"https://wwlhugij.labs.coursera.org/files/M1/nih/images-small/{image_names}"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>urls <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>()</span></code></pre></div>
<pre><code>[36m──[39m [1m[1mColumn specification[1m[22m [36m────────────────────────────────────────────────────────[39m
cols(
  Field1 = [31mcol_character()[39m
)</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jixing Liu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
